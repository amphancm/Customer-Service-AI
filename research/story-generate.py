import requests
import random

API_URL = "https://openrouter.ai/api/v1/chat/completions"
API_KEY = "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"
MODEL_NAME = "deepseek/deepseek-chat-v3-0324:free"

headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json"
}


def generate_chapter(chapter_num):
    prompt = (
        f"""แนวเรื่อง: แฟนตาซี, ผจญภัย, พัฒนาตัวละคร, ดราม่า, เวทมนตร์, ปีศาจ
แรงบันดาลใจ: Dungeons & Dragons, Skyrim, Dark Souls (เล็กน้อย)

โครงเรื่องหลัก:
เขียนนิยายแฟนตาซีที่ดำเนินเรื่องเป็นตอน ๆ มีเนื้อเรื่องต่อเนื่องกัน โดยมีตัวเอกเป็นเด็กเลี้ยงม้าชื่อ “เอเลียส” (Elias) ชายหนุ่มอายุ 22 ปี ผมดำยุ่งเล็กน้อย ผิวแทน ตาสีฟ้าสด ครอบครัวกำพร้าตั้งแต่เด็กและเติบโตมาในหมู่บ้านเล็ก ๆ ชายแดนของอาณาจักร Velmoria (เวลมอเรีย) ซึ่งเต็มไปด้วยสัตว์ร้ายและเงามืดของสงครามเวทมนตร์ในอดีต

วันหนึ่ง หมู่บ้านของเขาถูกโจมตีโดยปีศาจลึกลับที่มาจากมิติอื่น เอเลียสรอดชีวิตเพียงคนเดียวโดยหลบอยู่ในคอกม้าและเห็นหมู่บ้านถูกเผาทำลายต่อหน้าต่อตา หลังจากเหตุการณ์นั้น เขาตัดสินใจออกเดินทางเพื่อค้นหาคำตอบว่า “สิ่งนั้น” คืออะไร และเหตุใดถึงมาทำลายหมู่บ้านของเขา

ระหว่างการเดินทาง เอเลียสจะได้พบกับพรรคพวกหลากหลายเผ่าพันธุ์ เช่น เอลฟ์ผู้ใช้เวทมนตร์ นักบวชแห่งเทพโบราณ คนแคระนักประดิษฐ์ ฯลฯ เขาได้เรียนรู้เกี่ยวกับโลก กองกำลังแห่งแสงและความมืด ตำนานของ “The Bound Gate” – ประตูผนึกที่ว่ากันว่าสามารถเชื่อมโยงมิติของปีศาจเข้ากับโลกมนุษย์ได้

ธีมหลักของเรื่อง:
- การเติบโตจากคนธรรมดาสู่วีรบุรุษ
- ความจริงของโลกที่ถูกปกปิด
- ความหมายของการมีพลังและความรับผิดชอบ
- มิตรภาพและการทรยศ
- การต่อสู้ระหว่างเจตจำนงเสรีกับชะตากรรม

สไตล์การเขียน:
บรรยายแบบมีรายละเอียด ฉากสมจริง ตัวละครมีมิติ มีบทสนทนาที่สื่อถึงความรู้สึกภายในและการพัฒนา จังหวะของเรื่องเน้นการค่อย ๆ เปิดเผยปริศนาและขยายโลก พร้อมกับฉากต่อสู้ที่สมจริงและดุดันในสไตล์ D&D

เริ่มต้นตอนแรกด้วย:
- การแนะนำตัวเอก “เอเลียส” ในชีวิตประจำวันในหมู่บ้าน
- การพูดคุยกับชาวบ้านและสังเกตความผิดปกติบางอย่าง เช่น ฟ้าผ่าตอนกลางวัน ควันดำจากภูเขา
- จากนั้นเกิดเหตุการณ์ปีศาจบุกอย่างกะทันหัน
- จบตอนแรกด้วยฉากที่เอเลียสรอดชีวิต และเดินออกจากหมู่บ้านที่กลายเป็นเถ้าถ่าน พร้อมแสงจันทร์เต็มดวง

เนื้อเรื่องไม่รองรับภาษาจีนและภาษาญี่ปุ่นควรใช้ภาษาไทยและEnglishเท่านั้น

นี่คือเนื้อเรื่องหัวข้อที่ {chapter_num}
"""
    )
    data = {
        "model": MODEL_NAME,
        "messages": [
            {"role": "user", "content": prompt}
        ],
        "max_tokens": random.randint(3000,10000),  # สุ่มจำนวนโทเคนในช่วงที่โมเดลรองรับ
        "temperature": 1.0
    }
    response = requests.post(API_URL, headers=headers, json=data)
    response.raise_for_status()
    return response.json()["choices"][0]["message"]["content"]

def main():
    with open("D_and_D.txt", "w", encoding="utf-8") as f:
        for i in range(1,1000):
            print(f"Generating chapter {i}...")
            chapter = generate_chapter(i)
            f.write(f"Chapter {i}\n")
            f.write(chapter.strip() + "\n\n")

if __name__ == "__main__":
    main()